description: >
  This command runs flake8 and security checks on a repo.
parameters:
  dir:
    description: the directory to run tests for
    type: string
    default: .
steps:
  - run:
      name: Create Environment
      command: |
        python3 -m venv security_checks_venv/
      working_directory: << parameters.dir >>
  - run:
      name: Run flake8     # Make sure each step here shows up as a separate task
      command: |
        source security_checks_venv/bin/activate
        pip install flake8
        pwd
        ls
      working_directory: << parameters.dir >>
  - run:
      name: Run Safety Check
      command: |
        source security_checks_venv/bin/activate
        pip install safety
        safety check
      working_directory: << parameters.dir >>
  - run:
      name: Run Bandit Check
      command: |
        source security_checks_venv/bin/activate
        pip install bandit
        bandit -x '*/venv/*','*/tests/*' -r . -ll    # <--- lightly edited to run in current directory, make sure it works
      working_directory: << parameters.dir >>
